---
layout: post
title:  "Contracts"
date:   2018-06-15
permalink: 'contract.html'
---

_Contract_ is a concept that allows you to describe what kind of inputs your models expects and what it will produce as an output. 


# Library support

When it's possible ML Lambda can interpretate your models without you providing any additional information. But not all libraries actually allow that. Some of them does not provide required metadata, so you would have to descibe the model by yourself (i.e. write a `contract.prototxt` and `serving.yaml` for your model). Below we listed libraries which can be inferred and which are not.  

| Library | Inferring | Commentaries |
| ------- | --------- | ------------ |
| TensorFlow | 90% | TensorFlow saves all needed metadata in `SavedModel`, so generated contracts will be pretty accurate.  |
| Spark | 50% | Spark has metadata, but it's insufficient and contract inference may be inaccurate. |
| MXNet | 0% | MXNet has it's own export mechanism, but it does not contain any metadata related to types and shapes. |
| SkLearn | 0% | Exported models does not provide required metadata. |
| Theano | 0% | Exported models does not provide required metadata. |

# Writing contracts

To let ML Lambda understand your models you have to provde to files.

1. A `service.yaml` file, that provides a definition of your model.

	```yaml
model:
  name: "model"
  type: "python:3.6"
  contract: "contract.prototxt"
  payload:
  - "src/"
	```

2. A `contract.prototxt` file, that provides information about your model's inputs and outputs.

	```
signatures {
  signature_name: "serving"
  inputs {
       name: "profile"
         shape: {
           dim: {
    	     size: 112
           }
	     }
	   dtype: DT_DOUBLE
  }
  outputs {
	   name: "one"
	   dtype: DT_DOUBLE
  }
  outputs {
	   name: "two"
	   dtype: DT_DOUBLE
  }
}
	```