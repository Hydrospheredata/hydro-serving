---
layout: post
title:  "Runtimes"
date:   2018-06-15
permalink: 'runtimes.html'
---

 
_Runtimes_ are servers with the predefined infrasturcture. They must implement a set if specific methods that are used by `manager`. Those servers run in the docker environments and responsible for running user-defined models. When you create a new application and assign a model to it, you also have to provide a specific runtime, which will be used to run your model. 

# Available runtimes

We're already implemented a few runtimes which you can use in your own projects. They are all opensource and you can look up code if you need. 

| Runtime | Versions | Links
| ------- | ------- | ---- |
| hydrosphere/serving-runtime-python | 3.6-latest<br>3.5-latest<br>3.4-latest | [Docker Hub][docker-hub-python]<br>[Github][github-serving-python]|
| hydrosphere/serving-runtime-tensorflow | 1.4.0-latest<br>1.5.0-latest<br>1.6.0-latest<br>1.7.0-latest | [Docker Hub][docker-hub-tensorflow]<br>[Github][github-serving-tensorflow] |
| hydrosphere/serving-runtime-spark | 2.0-latest<br>2.1-latest<br>2.2-latest | [Docker Hub][docker-hub-spark]<br>[Github][github-serving-spark] |


# Developing runtime


Sometimes you have to use technology that we are not supporting yet or you need more flexibility and you want to implement your own runtime. It may seem frightening at first glance, but it's actually not that difficult. Hydro-serving is designed to abstract it's guts from model users and runtime developers. The key things you have to know to write your own runtime are: 

* Knowing how to implement a predefined gRPC service;
* Understanding our contracts' protobufs to describe entrypoints, such as inputs and outputs. (This requires knowledge about protobuf protocol);
* Knowing how to create your own docker image and publish it to some registry.


## Example

There're different approaches on how to generate client and server gRPC code on [different languages][grpc-docs]. Let's have a look on how to do that in Python.

First, let's clone our [protocols][github-serving-protos] and prepare a folder for generated code.

```sh
$ git clone https://github.com/Hydrospheredata/hydro-serving-protos
$ mkdir generated-grpc
```

For generating gRPC code we need additional packages. 

```sh
$ pip install grpcio-tools googleapis-common-protos
```

Runtimes only depend on contracts and service, so we're compiling only them.

```sh
$ python -m grpc_tools.protoc --proto_path=./hydro-serving-protos/src/ --python_out=./generated-grpc/ --grpc_python_out=./generated-grpc/ $(find ./src/hydro_serving_grpc/contract/ -type f)
$ python -m grpc_tools.protoc --proto_path=./hydro-serving-protos/src/ --python_out=./generated-grpc --grpc_python_out=./generated-grpc/ $(find ./src/hydro_serving_grpc/tf/api/ -type f)
```



### 1. Creating gRPC service

There

<!-- 
# Setting up Runtime

To set up a runtime simply execute the following lines in your terminal. Make sure, that _ML Lambda_ is running and also make sure, that __the name of the runtime__ (e.g. `name` value in the dictionary) __is consistent with the name of repository in the docker hub.__

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "NAME_OF_THE_RUNTIME",
   "version": "VERSION_OF_THE_RUNTIME",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
```

# Available Runtimes

For your convinience we assembled a list of our latest available runtimes. Page `Tags` in the Docker Hub's repository contains all versions of the runtime.

## Python 3
{: #python}

- [Docker Hub][docker-hub-python]

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "hydrosphere/serving-runtime-python",
   "version": "3.6-latest",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
```

## Spark 
{: #spark}

- [Docker Hub][docker-hub-spark]

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "hydrosphere/serving-runtime-spark",
   "version": "2.2-latest",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
```

## TensorFlow
{: #tensorflow}

- [Docker Hub][docker-hub-tensorflow]

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "hydrosphere/serving-runtime-tensorflow",
   "version": "1.7.0-latest",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
```

## SciKit
{: #scikit}

- [Docker Hub][docker-hub-scikit]

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "hydrosphere/serving-runtime-scikit",
   "version": "0.0.4-latest",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
```

## PyTorch
{: #pytorch}

- [Docker Hub][docker-hub-pytorch]

```sh
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
   "name": "hydrosphere/serving-runtime-pytorch",
   "version": "latest-cpu",
   "modelTypes": [
     "string"
   ],
   "tags": [
     "string"
   ],
   "configParams": {}
 }' 'http://localhost:8080/api/v1/runtime'
``` -->

[grpc-docs]: https://grpc.io/docs/
[docker-hub]: https://hub.docker.com/u/hydrosphere/
[docker-hub-python]: https://hub.docker.com/r/hydrosphere/serving-runtime-python/
[docker-hub-spark]: https://hub.docker.com/r/hydrosphere/serving-runtime-spark/
[docker-hub-tensorflow]: https://hub.docker.com/r/hydrosphere/serving-runtime-tensorflow/
[docker-hub-scikit]: https://hub.docker.com/r/hydrosphere/serving-runtime-scikit/
[docker-hub-pytorch]: https://hub.docker.com/r/hydrosphere/serving-runtime-pytorch/
[github-serving-python]: https://github.com/Hydrospheredata/hydro-serving-python
[github-serving-tensorflow]: https://github.com/Hydrospheredata/hydro-serving-tensorflow
[github-serving-spark]: https://github.com/Hydrospheredata/hydro-serving-spark
[github-serving-protos]: https://github.com/Hydrospheredata/hydro-serving-protos